<?php
require_once __DIR__ . '/../../config/app.php';// Verificar si la sesión está iniciada

if (session_status() == PHP_SESSION_NONE) {
    session_start();
}

// Conexión a la base de datos
require_once __DIR__ . '/../../config/server.php'; // Ruta a la clase server.php
$conn = Database::connect();

$empresa = $_POST['empresa'];
$nit = $_POST['nit'];                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
$direccion = $_POST['direccion'];
$telefono = $_POST['telefono'];
$correo = $_POST['correo'];
$contacto = $_POST['contacto'];
$fecha_remision = date('Y-m-d');
$proyecto = $_POST['id_remision'];
$prject = $_POST['proyecto'];
$ciudad = $_POST['ciudad'];



//validacion de exitensia en a la tabla temp_remision_item
$sql = "SELECT * FROM temp_remision_item";
$stmt = $conn->prepare($sql);
$stmt->execute();
$temp = $stmt->fetchColumn();

if($temp ==0){
    echo "<script>
    alert('No se ha seleccionado ningun item para la remision');
       
        window.location.href = '".APP_URL."?views=Remision1';

    </script>";
}


$sqlInRem = "INSERT INTO remision(empresa,nit,direccion,contacto,telefono,correo,fecha_remision, proyecto, ciudad)
 VALUES (:empresa,:nit,:direccion,:contacto,:telefono,:correo,:fecha_remision, :proyecto, :ciudad)";
$stmt_insert_remision = $conn->prepare($sqlInRem);
$stmt_insert_remision->bindParam(':empresa', $empresa);
$stmt_insert_remision->bindParam(':nit', $nit);
$stmt_insert_remision->bindParam(':direccion', $direccion);
$stmt_insert_remision->bindParam(':contacto', $contacto);
$stmt_insert_remision->bindParam(':telefono', $telefono);
$stmt_insert_remision->bindParam(':correo', $correo);
$stmt_insert_remision->bindParam(':fecha_remision', $fecha_remision);
$stmt_insert_remision->bindParam(':proyecto', $prject);
$stmt_insert_remision->bindParam(':ciudad', $ciudad);

if($stmt_insert_remision->execute()){
    $id_itemRem = $conn->lastInsertId();
    header("Location: ".APP_URL."?views=Remmision&id=" . $proyecto. "&idRe=". $id_itemRem);
    exit();
    
}


